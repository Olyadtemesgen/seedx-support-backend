# SeedX Support Backend

## 📦 Project Overview

This backend powers the SeedX Support system. It includes secure authentication, ticketing, messaging, and AI message streaming, all powered by FastAPI, PostgreSQL, SQLAlchemy, and Docker.

---

## ✅ Evaluation Criteria

### 1. 🧼 Code Quality & OOP

- Clean, readable, fully type-annotated Python code.
- Follows PEP8, formatted with `black` and `isort`.
- Uses Object-Oriented Design:
  - Abstract `RepositoryInterface` with typed generics.
  - Service layer classes like `UserService`, `AuthService`.
- Good separation of concerns:
  - API (`resource.py`), logic (`service.py`), database (`repository.py`).

---

### 2. 🏗 Architecture

- Modular layout under `src/seedx_support_backend/`:
  - `users/`, `tickets/`, `messages/`, `infrastructure/`
- Service/Repository pattern separates logic from DB operations.
- App factory pattern (`create_app`) used for flexibility and testing.
- Configuration management with `pydantic-settings`.

---
## 🗂️ Project Structure

```
seedx-support-backend/
│
├── alembic/                        # DB migration scripts
│   ├── versions/                   # Autogenerated migration files
│   └── env.py                      # Alembic env config
│
├── src/
│   ├── app.py                      # App factory for FastAPI
│   ├── config.py                   # Environment and settings using pydantic-settings
│   ├── middleware.py               # Middleware setup (CORS, etc.)
│
│   └── seedx_support_backend/
│       ├── infrastructure/
│       │   ├── database.py         # SQLAlchemy base and engine
│       │   ├── repository.py       # Abstract repository interfaces
│
│       ├── users/
│       │   ├── models.py           # SQLAlchemy User model
│       │   ├── core.py             # Pydantic schemas for User
│       │   ├── service.py          # Business logic for users
│       │   ├── resource.py         # API routes for auth & user
│       │   └── repository.py       # User repository
│
│       ├── tickets/
│       │   ├── models.py           # Ticket DB model
│       │   ├── core.py             # Pydantic schemas for tickets
│       │   ├── service.py          # Ticket logic
│       │   └── resource.py         # Ticket API routes
│
│       ├── messages/
│       │   ├── models.py           # Message DB model
│       │   ├── core.py             # Pydantic schemas for messages
│       │   ├── service.py          # Message logic
│       │   └── resource.py         # Message API routes
│
│       └── ai/
│           ├── service.py          # AI integration with Groq
│           └── resource.py         # Streaming endpoint
│
├── Dockerfile                      # Docker image definition
├── docker-compose.yml              # Compose config for app & db
├── .env                            # Environment variables
├── pyproject.toml                  # Poetry project definition
├── Makefile                        # CLI tasks (build, up, down, test)
└── README.md                       # Project overview
```

### 3. 🧪 Technical Requirements

- **Authentication**:
  - JWT-based auth using `pyjwt`, `passlib`, and FastAPI security utils.
  - Signup & login with hashed password handling.
- **Database Integration**:
  - PostgreSQL via SQLAlchemy 2.0.
  - Alembic for schema migrations.
- **AI Streaming**:
  - Groq-compatible streaming hook included.
  - Endpoint for AI-generated responses (pluggable logic).
- **Docker Setup**:
  - Multi-stage Dockerfile for minimal runtime size.
  - `docker-compose.yml` includes app + Postgres DB.
  - `.env` for secrets and config.

---

### 4. 📘 Documentation

#### Setup Instructions

```bash
# Clone the repo
git clone <https://github.com/Olyadtemesgen/seedx-support-backend>

# Add env vars
cp .env.example .env

# Build and run
make build
make up

# Run DB migrations
docker-compose exec app alembic upgrade head # this is already included in the docker-compose file (we don't need to run it manually, just incase :))
```

## API Endpoints

| Method | Path                            | Description                          |
|--------|---------------------------------|--------------------------------------|
| POST   | /auth/signup                    | Create a new user                    |
| POST   | /auth/login                     | Login and receive JWT                |
| GET    | /tickets                        | List user's tickets                  |
| POST   | /tickets                        | Create a new support ticket          |
| GET    | /tickets/{ticket_id}           | Get a specific ticket with messages  |
| POST   | /tickets/{ticket_id}/messages  | Add a message to a ticket            |
| GET    | /tickets/{ticket_id}/ai-response | Stream an AI response (SSE)        |

FastAPI docs available at: [http://localhost:8443/docs](http://localhost:8443/docs)


> 🔗 FastAPI docs available at: `http://localhost:8443/docs`

---

## 🔧 Environment Variables (.env)

```env
DATABASE_URL=postgresql://postgres:postgres@db:5432/supportdb
JWT_SECRET=jwt_secret....
JWT_KEY=your_jwt_key
EXPIRE_MINUTES=60
GROK_API_KEY=your_groq_key
GROK_API_URL=https://api.groq.com
ALLOWED_ORIGINS=http://localhost,http://localhost:3000

```
## 💡 Design Decisions

- Used `pydantic-settings` for clean env config loading.
- All routes versionable and easily testable due to app factory.
- Repository pattern makes mocking easy during tests.
- Streaming allows real-time AI use cases.
- Docker ensures consistent reproducibility and deployment.

---

## 🧪 Testing

The testing is not added yet but we can Include tests for:

- Auth service  
- Token logic  
- Message validation  
- Repository behavior  

---

## 🧩 Final Thoughts

The system is scalable, testable, and well-isolated by concern.  
Designed to integrate seamlessly with both internal support staff workflows and future AI augmentation pipelines.
